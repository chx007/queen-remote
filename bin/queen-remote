#!/usr/bin/env node

var app = require('commander'),
	path = require('path'),
	vm = require('vm'),
	utils = require('../lib/utils.js'),
	fs = require('fs'),
	queenRemote = require('../'),
	queenRunner = queenRemote.runner,
	queenRemoteClientFactory = queenRemote.client,
	appConfig = require('../package.json');

app.version(appConfig.version);	

app.option('-h, --host [host]', 'The host to bind the remote server to')
	.option('-r, --relay [relay]', 'Act as a proxy queen server for other remotes by providing a host for this option')
	.option('-v, --verbose', 'Whether to log verbosely')
	.option('-q, --quiet', 'Don\'t output anything to output stream')

var config = {};
app.command("*").action(function(filePath){
	if(~filePath.indexOf("://")){
		config.script = filePath;
	} else {
		config.file = path.resolve(process.cwd(), filePath);
	}
});

app.on('--help', function(){
  console.log('  Examples:');
  console.log('');
  console.log('  Run a JavaScript file using a remote queen server, adding in a "queen" global variable:');
  console.log('     $ queen-remote -h queen.turn.com my-queen-script.js');
  console.log('');
});

app.parse(process.argv);

config.host = app.host;
config.quiet = app.quiet;
config.verbose = app.verbose;
config.relay = app.relay;

queenRunner(queenRemoteClientFactory, config);
